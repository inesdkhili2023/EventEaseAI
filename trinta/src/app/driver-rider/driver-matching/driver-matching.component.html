<div class="container">

  <h2>🚗 Gestion des Chauffeurs & Matching</h2>
<div id="map" class="map-container"></div>
  <!-- 🧍 Formulaire chauffeur -->
  <div class="driver-form card">
    <h3>Ajouter un Chauffeur</h3>
    <div class="form-group">
      <label>Nom :</label>
      <input type="text" [(ngModel)]="newDriver.nom" />
    </div>
    
    <div class="form-group">
      <label>Nombre de places :</label>
      <input type="number" [(ngModel)]="newDriver.capacity" min="1" />
    </div>
    <button class="btn-primary" (click)="addDriver()">📍 Ajouter</button>
  </div>

  <!-- 🗺️ Carte -->
 <!-- 🗺️ Carte OpenStreetMap -->



  <!-- 🪟 Popup chauffeur -->
  <div *ngIf="selectedDriver" class="popup">
    <h4> {{ selectedDriver.nom }}</h4>
    <p>🚗 {{ selectedDriver.vehicleType }} - {{ selectedDriver.capacity }} places</p>
    <p>⭐ {{ selectedDriver.rating }}/5</p>
    <p>📞 {{ selectedDriver.numTel || 'Non renseigné' }}</p>
    <button class="btn-update" (click)="updateDriverPosition(selectedDriver)">🔁 Actualiser position</button>
    <button class="btn-close" (click)="selectedDriver = null">Fermer</button>
  </div>

  <!-- 🤝 Matching -->
  <div class="rider-form card">
    <h3>Matching Chauffeurs ↔ Client</h3>
    <div class="form-group">
      <label>Nombre de passagers:</label>
      <input type="number" [(ngModel)]="rider.passengerCount" min="1" max="8">
    </div>

    <div class="form-group">
      <label>Urgence:</label>
      <select [(ngModel)]="rider.urgencyLevel">
        <option value="low">Faible</option>
        <option value="medium">Moyenne</option>
        <option value="high">Élevée</option>
      </select>
    </div>

    <button (click)="findBestMatches()" [disabled]="isLoading" class="btn-primary">
      {{ isLoading ? 'Recherche...' : '🔍 Trouver les meilleurs chauffeurs' }}
    </button>
  </div>

  <!-- 🏆 Résultats -->
  <div *ngIf="matches.length" class="results-section">
    <h3>🏆 Chauffeurs recommandés</h3>
    <div class="matches-grid">
      <div *ngFor="let match of matches" class="match-card" [style.border-color]="getScoreColor(match.score)">
        <h4>{{ match.driverName }}</h4>
        <p>🚗 {{ match.vehicleType }} | ⭐ {{ match.rating }}/5</p>
        <p>📍 {{ match.distance | number:'1.1-2' }} km | ⏱ {{ match.travelTime }} min</p>
        <p>💰 {{ match.pricePerKm }} TND/km</p>
        <button (click)="contactDriver(match.phoneNumber)" class="btn-contact">📞 Contacter</button>
      </div>
    </div>
  </div>

  <!-- 🔄 Erreur / chargement -->
  <div *ngIf="isLoading" class="loading">Recherche en cours...</div>
  <div *ngIf="errorMessage" class="error-message">{{ errorMessage }}</div>

</div>
