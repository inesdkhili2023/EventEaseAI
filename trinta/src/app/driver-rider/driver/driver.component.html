<div class="driver-container">
  <mat-card class="driver-card">
    <mat-card-header>
      <mat-card-title>
        <h3>üöó Cr√©ation d‚Äôun nouveau chauffeur</h3>
      </mat-card-title>
    </mat-card-header>

    <mat-card-content>
      <form #driverForm="ngForm" (ngSubmit)="addDriver()" novalidate>
        <div class="row">
          <!-- Nom -->
          <div class="col-md-6">
            <div class="input-with-icon">
              <i-feather name="user"></i-feather>
              <mat-form-field appearance="outline">
                <mat-label>Nom *</mat-label>
                <input
                  matInput
                  name="nom"
                  [(ngModel)]="newDriver.nom"
                  #nomInput="ngModel"
                  required
                  minlength="2"
                  placeholder="Ex. Dupont"
                />
                <mat-error *ngIf="nomInput.invalid && (nomInput.touched || nomInput.dirty)">
                  <span *ngIf="nomInput.errors?.['required']">Le nom est obligatoire.</span>
                  <span *ngIf="nomInput.errors?.['minlength']">Le nom doit contenir au moins 2 caract√®res.</span>
                </mat-error>
              </mat-form-field>
            </div>
          </div>

          <!-- Pr√©nom -->
          <div class="col-md-6">
            <div class="input-with-icon">
              <i-feather name="user"></i-feather>
              <mat-form-field appearance="outline">
                <mat-label>Pr√©nom *</mat-label>
                <input
                  matInput
                  name="prenom"
                  [(ngModel)]="newDriver.prenom"
                  #prenomInput="ngModel"
                  required
                  placeholder="Ex. Jean"
                />
                <mat-error *ngIf="prenomInput.invalid && (prenomInput.touched || prenomInput.dirty)">
                  Le pr√©nom est obligatoire.
                </mat-error>
              </mat-form-field>
            </div>
          </div>

          <!-- Email -->
          <div class="col-md-6">
            <div class="input-with-icon">
              <i-feather name="mail"></i-feather>
              <mat-form-field appearance="outline">
                <mat-label>Email *</mat-label>
                <input
                  matInput
                  name="email"
                  type="email"
                  [(ngModel)]="newDriver.email"
                  #emailInput="ngModel"
                  required
                  email
                  placeholder="email@exemple.com"
                />
                <mat-error *ngIf="emailInput.invalid && (emailInput.touched || emailInput.dirty)">
                  <span *ngIf="emailInput.errors?.['required']">L‚Äôadresse email est obligatoire.</span>
                  <span *ngIf="emailInput.errors?.['email']">Adresse email invalide.</span>
                </mat-error>
              </mat-form-field>
            </div>
          </div>
          <!-- Mot de passe -->
<div class="col-md-6">
  <div class="input-with-icon">
    <i-feather name="lock"></i-feather>
    <mat-form-field appearance="outline">
      <mat-label>Mot de passe *</mat-label>
      <input
        matInput
        type="password"
        name="password"
        [(ngModel)]="newDriver.password"
        #passwordInput="ngModel"
        required
        minlength="6"
        placeholder="********"
      />
      <mat-hint>Minimum 6 caract√®res</mat-hint>
      <mat-error *ngIf="passwordInput.invalid && (passwordInput.touched || passwordInput.dirty)">
        <span *ngIf="passwordInput.errors?.['required']">Le mot de passe est obligatoire.</span>
        <span *ngIf="passwordInput.errors?.['minlength']">6 caract√®res minimum requis.</span>
      </mat-error>
    </mat-form-field>
  </div>
</div>


          <!-- T√©l√©phone -->
          <div class="col-md-6">
            <div class="input-with-icon">
              <i-feather name="phone"></i-feather>
              <mat-form-field appearance="outline">
                <mat-label>T√©l√©phone</mat-label>
                <input
                  matInput
                  name="numTel"
                  [(ngModel)]="newDriver.num_tel"
                  #numTelInput="ngModel"
                  pattern="^\+?[0-9\s]{8,15}$"
                  placeholder="+216 XX XXX XXX"
                />
                <mat-hint>Format : +216 22 345 678</mat-hint>
                <mat-error *ngIf="numTelInput.invalid && (numTelInput.touched || numTelInput.dirty)">
                  Num√©ro invalide. Utilisez : +216 22 345 678
                </mat-error>
              </mat-form-field>
            </div>
          </div>

          <!-- Type de v√©hicule -->
          <div class="col-md-6">
            <div class="input-with-icon">
              <i-feather name="truck"></i-feather>
              <mat-form-field appearance="outline">
                <mat-label>Type de v√©hicule</mat-label>
                <mat-select [(ngModel)]="newDriver.vehicleType" name="vehicleType">
                  <mat-option value="Standard">Standard</mat-option>
                  <mat-option value="VIP">VIP</mat-option>
                  <mat-option value="Luxe">Luxe</mat-option>
                  <mat-option value="Familial">Familial</mat-option>
                </mat-select>
              </mat-form-field>
            </div>
          </div>

          <!-- Nombre de places -->
          <div class="col-md-6">
            <div class="input-with-icon">
              <i-feather name="users"></i-feather>
              <mat-form-field appearance="outline">
                <mat-label>Nombre de places</mat-label>
                <input
                  matInput
                  type="number"
                  name="capacity"
                  [(ngModel)]="newDriver.capacity"
                  min="1"
                  max="8"
                />
                <mat-error *ngIf="newDriver.capacity < 1 || newDriver.capacity > 8">
                  Le nombre de places doit √™tre entre 1 et 8.
                </mat-error>
              </mat-form-field>
            </div>
          </div>

          <!-- Adresse -->
          <div class="col-md-6">
            <div class="input-with-icon">
              <i-feather name="map-pin"></i-feather>
              <mat-form-field appearance="outline">
                <mat-label>Adresse</mat-label>
                <input
                  matInput
                  name="adresse"
                  [(ngModel)]="newDriver.adresse"
                  placeholder="Adresse compl√®te"
                />
              </mat-form-field>
            </div>
          </div>

          <!-- Exp√©rience -->
          <div class="col-md-6">
            <div class="input-with-icon">
              <i-feather name="briefcase"></i-feather>
              <mat-form-field appearance="outline">
                <mat-label>Ann√©es d‚Äôexp√©rience</mat-label>
                <input
                  matInput
                  type="number"
                  name="experienceYears"
                  [(ngModel)]="newDriver.experienceYears"
                  min="0"
                />
                <mat-error *ngIf="newDriver.experienceYears < 0">
                  Les ann√©es d‚Äôexp√©rience ne peuvent pas √™tre n√©gatives.
                </mat-error>
              </mat-form-field>
            </div>
          </div>
        </div>

        <!-- üìç Section position -->
        <div class="position-section">
          <h4>üìç S√©lection de la position</h4>

          <div class="position-actions">
            <button mat-stroked-button color="primary" type="button" (click)="openPositionMap()">
              üó∫Ô∏è Choisir sur la carte
            </button>
            <button mat-stroked-button color="accent" type="button" (click)="useCurrentLocation()">
              üìç Utiliser ma position actuelle
            </button>
          </div>

          <div class="position-info" *ngIf="selectedPosition">
            <p>
              <strong>Position :</strong>
              {{ selectedPosition.lat | number: "1.6-6" }},
              {{ selectedPosition.lng | number: "1.6-6" }}
            </p>
          </div>

          <div *ngIf="!selectedPosition && positionTouched" class="alert alert-warning">
            ‚ö†Ô∏è La position est obligatoire. Veuillez la s√©lectionner.
          </div>
        </div>

        <!-- üü¢ Carte principale (pour visualiser les chauffeurs) -->
        <div id="driver-map" class="main-map"></div>

        <!-- Bouton principal -->
        <div class="form-actions">
          <button mat-raised-button color="primary" type="submit"
            [disabled]="driverForm.invalid || !selectedPosition">
            ‚úÖ Cr√©er le chauffeur
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>

  <!-- Messages -->
  <div *ngIf="successMessage" class="alert alert-success fade-in">
    ‚úÖ {{ successMessage }}
  </div>
  <div *ngIf="errorMessage" class="alert alert-danger fade-in">
    ‚ö†Ô∏è {{ errorMessage }}
  </div>

  <!-- Modal carte -->
  <div *ngIf="showPositionMap" class="modal-overlay" (click)="closePositionMap()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>üó∫Ô∏è S√©lectionnez votre position</h3>
        <button class="btn-close" (click)="closePositionMap()">√ó</button>
      </div>
      <div class="modal-body">
        <div id="position-map" class="position-map-container"></div>
        <div class="modal-actions">
          <button mat-stroked-button color="accent" (click)="centerOnCurrentLocation()">
            üìç Centrer sur ma position
          </button>
          <button mat-raised-button color="primary" (click)="validatePosition()">
            ‚úÖ Valider la position
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
