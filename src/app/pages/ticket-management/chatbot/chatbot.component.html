<!-- Chatbot Toggle Button -->
<div class="chatbot-toggle" *ngIf="!isOpen">
  <button 
    mat-fab 
    color="primary" 
    (click)="toggleChatbot()"
    matTooltip="Ouvrir l'assistant virtuel">
    <mat-icon>chat</mat-icon>
  </button>
</div>

<!-- Chatbot Widget -->
<div class="chatbot-widget" [class.open]="isOpen" [class.minimized]="isMinimized">
  
  <!-- Header -->
  <div class="chatbot-header">
    <div class="header-info">
      <div class="bot-avatar">
        <mat-icon>smart_toy</mat-icon>
      </div>
      <div class="bot-info">
        <h3>Assistant Virtuel</h3>
        <p>En ligne</p>
      </div>
    </div>
    <div class="header-actions">
      <button 
        mat-icon-button 
        (click)="minimizeChatbot()" 
        *ngIf="!isMinimized"
        matTooltip="Réduire">
        <mat-icon>minimize</mat-icon>
      </button>
      <button 
        mat-icon-button 
        (click)="maximizeChatbot()" 
        *ngIf="isMinimized"
        matTooltip="Agrandir">
        <mat-icon>maximize</mat-icon>
      </button>
      <button 
        mat-icon-button 
        (click)="toggleChatbot()"
        matTooltip="Fermer">
        <mat-icon>close</mat-icon>
      </button>
    </div>
  </div>

  <!-- Messages Container -->
  <div class="messages-container" #messagesContainer *ngIf="!isMinimized">
    <div class="messages-list">
      <div 
        *ngFor="let message of messages" 
        class="message"
        [class.user-message]="message.isUser"
        [class.bot-message]="!message.isUser"
        [class]="getMessageTypeClass(message)">
        
        <div class="message-content">
          <div class="message-text" [innerHTML]="message.content"></div>
          <div class="message-time">{{ formatMessageTime(message.timestamp) }}</div>
        </div>
      </div>

      <!-- Typing Indicator -->
      <div class="typing-indicator" *ngIf="isTyping">
        <div class="typing-dots">
          <span></span>
          <span></span>
          <span></span>
        </div>
        <span class="typing-text">L'assistant tape...</span>
      </div>
    </div>

    <!-- Quick Replies -->
    <div class="quick-replies" *ngIf="messages.length > 1 && !isTyping">
      <p class="quick-replies-label">Réponses rapides :</p>
      <div class="quick-replies-list">
        <mat-chip 
          *ngFor="let reply of quickReplies" 
          (click)="sendQuickReply(reply)"
          (keydown.enter)="sendQuickReply(reply)"
          (keydown.space)="sendQuickReply(reply)"
          class="quick-reply-chip"
          tabindex="0">
          {{ reply.text }}
        </mat-chip>
      </div>
    </div>
  </div>

  <!-- Input Area -->
  <div class="input-area" *ngIf="!isMinimized">
    <div class="input-container">
      <mat-form-field appearance="outline" class="message-input">
        <mat-label>Tapez votre message...</mat-label>
        <textarea 
          matInput 
          [(ngModel)]="currentMessage"
          (keypress)="onKeyPress($event)"
          rows="1"
          placeholder="Posez votre question...">
        </textarea>
      </mat-form-field>
      <button 
        mat-icon-button 
        color="primary" 
        (click)="sendMessage()"
        [disabled]="!currentMessage.trim()">
        <mat-icon>send</mat-icon>
      </button>
    </div>
  </div>

  <!-- Footer Actions -->
  <div class="chatbot-footer" *ngIf="!isMinimized">
    <button 
      mat-button 
      (click)="clearChat()"
      matTooltip="Effacer la conversation">
      <mat-icon>clear_all</mat-icon>
      Effacer
    </button>
    <button 
      mat-button 
      (click)="exportChat()"
      matTooltip="Exporter la conversation">
      <mat-icon>download</mat-icon>
      Exporter
    </button>
  </div>
</div>
